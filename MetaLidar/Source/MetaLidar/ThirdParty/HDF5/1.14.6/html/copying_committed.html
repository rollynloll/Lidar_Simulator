<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HDF5: Copying Committed Datatypes with H5Ocopy</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="hdf5doxy.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="hdf5doxy.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="hdf5_navtree_hacks.js"></script>
<div style="background:#FFDDDD;font-size:120%;text-align:center;margin:0;padding:5px">Please, help us to better serve our user community by answering the following short survey:  <a href="https://www.hdfgroup.org/website-survey/">https://www.hdfgroup.org/website-survey/</a></div>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="HDFG-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">HDF5<span id="projectnumber">&#160;1.14.6</span>
   </div>
   <div id="projectbrief">API Reference</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="_getting_started.html"><span>Getting&#160;started</span></a></li>
      <li><a href="_u_g.html"><span>User&#160;Guide</span></a></li>
      <li><a href="_r_m.html"><span>Reference&#160;Manual</span></a></li>
      <li><a href="_cookbook.html"><span>Cookbook</span></a></li>
      <li><a href="_t_n.html"><span>Technical&#160;Notes</span></a></li>
      <li><a href="_r_f_c.html"><span>RFCs</span></a></li>
      <li><a href="_s_p_e_c.html"><span>Specifications</span></a></li>
      <li><a href="_g_l_s.html"><span>Glossary</span></a></li>
      <li><a href="_f_t_s.html"><span>Full-Text&#160;Search</span></a></li>
      <li><a href="_about.html"><span>About</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('copying_committed.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Copying Committed Datatypes with H5Ocopy</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>HDF5 Release 1.8.9 May 2012</p>
<h1><a class="anchor" id="sec_copying_committed_datatypes"></a>
Copying Committed Datatypes with H5Ocopy</h1>
<p>Committed datatypes can be a powerful feature in HDF5. They can be used to share a single datatype description among multiple datasets, to save space or ensure that the datatypes are truly identical, and to assign a name to that datatype within the HDF5 group structure. The object copy API, <a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a>, can be used to copy HDF5 objects from one file to another, including committed datatypes and objects that use them. However, problems can occur when a dataset using a committed datatype or an object with an attribute that uses a committed datatype is copied to another file with <a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a>.</p>
<p>When copying a dataset that uses a committed datatype or an object with an attribute that uses a committed datatype between files, the library by default does not look for a matching committed datatype in the destination file. The library creates a new committed datatype in the destination file without any links to it (an anonymous committed datatype) and then links the dataset to the anonymous committed datatype. This means that, when copying multiple datasets in separate calls to <a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a>, a new committed datatype is created for each <a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a> call. While it is possible to have all of the copied datasets share the same committed datatype by copying them in a single call to <a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a>, this is not always attainable.</p>
<p>For example, imagine that a user has an application that automatically creates many data files, each with many datasets that all use a single committed datatype. At the end of a project, the user wants to merge all of these files into a single file. The HDF5 Library can have all of the datasets in the combined file use the same committed datatype, but the default behavior of the library is to create an anonymous committed datatype for each dataset.</p>
<p>To make sure that shared committed datatypes in the source are shared in the copy, use the <a class="el" href="group___o_c_p_y_p_l.html#ga8819261e0b4663827212892e10dfc8a6" title="Sets properties to be used when an object is copied.">H5Pset_copy_object</a> property list API routine to set the <a class="el" href="_h5_opublic_8h.html#a11355b69cd246ae15e7d4c53cd210bd8">H5O_COPY_MERGE_COMMITTED_DTYPE_FLAG</a> flag. When this flag is set and <a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a> encounters an object or attribute that uses a committed datatype, H5Ocopy will search for a matching committed datatype in the destination file. If a matching committed datatype is found, then it will be used by the copied dataset or attribute. The next few paragraphs describe in more detail the process that <a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a> goes through.</p>
<p>When the <a class="el" href="_h5_opublic_8h.html#a11355b69cd246ae15e7d4c53cd210bd8">H5O_COPY_MERGE_COMMITTED_DTYPE_FLAG</a> flag is set, H5Ocopy will search the destination file for committed datatypes and build a temporary list in memory of all the committed datatypes it finds. Then, whenever H5Ocopy encounters a dataset that uses a committed datatype or an object with an attribute that uses a committed datatype in the source, it will check that list to see if it contains a datatype equal to the source datatype. If <a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a> finds an equal datatype, it will modify the copied object or attribute to use the found committed datatype as its datatype. <a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a> will then update the list if a new committed datatype is created in the destination file as a result of the copy. When later datasets and attributes using committed datatypes are encountered, the library will again check to see if the list contains a matching datatype.</p>
<p>To determine if two committed datatypes are equal, the library will compare their descriptions in a manner similar to <a class="el" href="group___h5_t.html#gaa92250f289b557b63cba974defa20b0f" title="Determines whether two datatype identifiers refer to the same datatype.">H5Tequal</a>. In addition, if either committed datatype has one or more attributes, then all attributes must be present in both committed datatypes, and the attributes must all be identical. Each attribute’s datatype description, dataspace, and raw data must be identical. However, if an attribute uses a committed datatype, then the attributes of the attribute’s committed datatype will not be compared.</p>
<p>When <a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a> encounters a committed datatype object in the source file, it will similarly search for a matching committed datatype in the destination file. If a match is found, the library will create a hard link in the destination file to the found datatype. If a match is not found, the library will copy the committed datatype normally and add it to the temporary list of committed datatypes in the destination file.</p>
<p>By default, <a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a> will search the entire destination file for a matching committed datatype. It is possible to focus where <a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a> will search. This focusing should result in a faster search. If there are locations in the destination file where a matching committed datatype might be found, then those locations can be specified with the <a class="el" href="group___o_c_p_y_p_l.html#gab89c9debe50afca848151ff046afc82f" title="Adds a path to the list of paths that will be searched in the destination file for a matching committ...">H5Padd_merge_committed_dtype_path</a> property.</p>
<p>The example below shows how to enable the feature described above for use with <a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a>.</p>
<p><em>Example1. Setting the object copy property list</em> </p><div class="fragment"><div class="line"><a class="code hl_typedef" href="_h5_ipublic_8h.html#a0045db7ff9c22ad35db6ae91662e1943">hid_t</a> ocpypl_id;</div>
<div class="line"> </div>
<div class="line">ocpypl_id = <a class="code hl_function" href="group___p_l_c_r.html#gaf1b11da01d4d45d788c45f8bc5f0cbfa">H5Pcreate</a>(<a class="code hl_define" href="_h5_ppublic_8h.html#a7cedfd989522e8d7697a414d1d707e43">H5P_OBJECT_COPY</a>);</div>
<div class="line">status = <a class="code hl_function" href="group___o_c_p_y_p_l.html#ga8819261e0b4663827212892e10dfc8a6">H5Pset_copy_object</a>(ocpypl_id, H5O_COPY_MERGE_COMMITTED_DT_FLAG);</div>
<div class="line">status = <a class="code hl_function" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225">H5Ocopy</a>(file1_id, src_name, file2_id, dst_name, ocpypl_id, <a class="code hl_define" href="_h5_ppublic_8h.html#afa85e97bfbf9bf1c58e39263846c568f">H5P_DEFAULT</a>);</div>
<div class="ttc" id="a_h5_ipublic_8h_html_a0045db7ff9c22ad35db6ae91662e1943"><div class="ttname"><a href="_h5_ipublic_8h.html#a0045db7ff9c22ad35db6ae91662e1943">hid_t</a></div><div class="ttdeci">int64_t hid_t</div><div class="ttdef"><b>Definition</b> H5Ipublic.h:60</div></div>
<div class="ttc" id="a_h5_ppublic_8h_html_a7cedfd989522e8d7697a414d1d707e43"><div class="ttname"><a href="_h5_ppublic_8h.html#a7cedfd989522e8d7697a414d1d707e43">H5P_OBJECT_COPY</a></div><div class="ttdeci">#define H5P_OBJECT_COPY</div><div class="ttdef"><b>Definition</b> H5Ppublic.h:120</div></div>
<div class="ttc" id="a_h5_ppublic_8h_html_afa85e97bfbf9bf1c58e39263846c568f"><div class="ttname"><a href="_h5_ppublic_8h.html#afa85e97bfbf9bf1c58e39263846c568f">H5P_DEFAULT</a></div><div class="ttdeci">#define H5P_DEFAULT</div><div class="ttdef"><b>Definition</b> H5Ppublic.h:228</div></div>
<div class="ttc" id="agroup___h5_o_html_gaa94449be6f67f499be5ddd3fc44f4225"><div class="ttname"><a href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225">H5Ocopy</a></div><div class="ttdeci">herr_t H5Ocopy(hid_t src_loc_id, const char *src_name, hid_t dst_loc_id, const char *dst_name, hid_t ocpypl_id, hid_t lcpl_id)</div><div class="ttdoc">Copies an object in an HDF5 file.</div></div>
<div class="ttc" id="agroup___o_c_p_y_p_l_html_ga8819261e0b4663827212892e10dfc8a6"><div class="ttname"><a href="group___o_c_p_y_p_l.html#ga8819261e0b4663827212892e10dfc8a6">H5Pset_copy_object</a></div><div class="ttdeci">herr_t H5Pset_copy_object(hid_t plist_id, unsigned copy_options)</div><div class="ttdoc">Sets properties to be used when an object is copied.</div></div>
<div class="ttc" id="agroup___p_l_c_r_html_gaf1b11da01d4d45d788c45f8bc5f0cbfa"><div class="ttname"><a href="group___p_l_c_r.html#gaf1b11da01d4d45d788c45f8bc5f0cbfa">H5Pcreate</a></div><div class="ttdeci">hid_t H5Pcreate(hid_t cls_id)</div><div class="ttdoc">Creates a new property list as an instance of a property list class.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="subsec_copying_committed_datatypes_cb"></a>
Callback Function</h2>
<p>If no matching datatype is found in the locations specified by the call to <a class="el" href="group___o_c_p_y_p_l.html#gab89c9debe50afca848151ff046afc82f" title="Adds a path to the list of paths that will be searched in the destination file for a matching committ...">H5Padd_merge_committed_dtype_path</a>, then <a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a> will by default search the entire destination file. In some cases, this may not be desirable. For instance, the user may expect the datatype to always have a match in the specified locations and may wish to return an error if a match is not found. The user may also have a very large file for which the full search incurs a substantial performance penalty. In this instance, the user may wish to log these events so that other datatypes can be added with <a class="el" href="group___o_c_p_y_p_l.html#gab89c9debe50afca848151ff046afc82f" title="Adds a path to the list of paths that will be searched in the destination file for a matching committ...">H5Padd_merge_committed_dtype_path</a>, or the user may wish to abort the search and copy the datatype normally.</p>
<p>To support these use cases, the functions <a class="el" href="group___o_c_p_y_p_l.html#ga9e0448885990a1b9ebd4493b7604f0c1" title="Sets the callback function that H5Ocopy() will invoke before searching the entire destination file fo...">H5Pset_mcdt_search_cb</a> and <a class="el" href="group___o_c_p_y_p_l.html#ga5d7b82394d37bda28769a0435300d396" title="Retrieves the callback function from the specified object copy property list.">H5Pget_mcdt_search_cb</a> have been added. These functions allow the user to define a callback function that will be called every time the list of paths added by <a class="el" href="group___o_c_p_y_p_l.html#gab89c9debe50afca848151ff046afc82f" title="Adds a path to the list of paths that will be searched in the destination file for a matching committ...">H5Padd_merge_committed_dtype_path</a> has been exhausted but before beginning the full search of the file. The prototype for the callback function is defined by <a class="el" href="_h5_opublic_8h.html#aa35611ba3daa73768194274c0e2a20eb">H5O_mcdt_search_cb_t</a>. The only argument to the callback function is a user supplied user data pointer, and the return value is an enum, defined by <a class="el" href="_h5_opublic_8h.html#a500f24019516869a4a61ac7efcb3b29b">H5O_mcdt_search_ret_t</a>, which tells the library to either continue with the full file search, abort the search and copy the datatype normally (create a new committed datatype in the destination file), or return an error.</p>
<h2><a class="anchor" id="subsec_copying_committed_datatypes_sum"></a>
Function Summary</h2>
<p>Functions used in committed datatype copying operations are listed below. </p><table class="doxtable">
<caption>Committed Datatype Copying Related Functions</caption>
<tr>
<th>Function</th><th>Purpose  </th></tr>
<tr>
<td><a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a></td><td>Allows an application to copy an object within an HDF5 file or to another HDF5 file.  </td></tr>
<tr>
<td><a class="el" href="group___o_c_p_y_p_l.html#ga8819261e0b4663827212892e10dfc8a6" title="Sets properties to be used when an object is copied.">H5Pset_copy_object</a></td><td>Allows an application to set properties to be used when an object is copied.  </td></tr>
<tr>
<td><a class="el" href="group___o_c_p_y_p_l.html#gab89c9debe50afca848151ff046afc82f" title="Adds a path to the list of paths that will be searched in the destination file for a matching committ...">H5Padd_merge_committed_dtype_path</a></td><td>Allows an application to add a path to the list of paths that will be searched in the destination file for a matching committed datatype.  </td></tr>
<tr>
<td><a class="el" href="group___o_c_p_y_p_l.html#ga4b8d6496ac56b167dba16729a8bd7adf" title="Clears the list of paths stored in the object copy property list.">H5Pfree_merge_committed_dtype_paths</a></td><td>Allows an application to clear the list of paths stored in the object copy property list <b>ocpypl_id</b>.  </td></tr>
<tr>
<td><a class="el" href="group___o_c_p_y_p_l.html#ga9e0448885990a1b9ebd4493b7604f0c1" title="Sets the callback function that H5Ocopy() will invoke before searching the entire destination file fo...">H5Pset_mcdt_search_cb</a></td><td>Allows an application to set the callback function that <a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a> will invoke before searching the entire destination file for a matching committed datatype.  </td></tr>
<tr>
<td><a class="el" href="group___o_c_p_y_p_l.html#ga5d7b82394d37bda28769a0435300d396" title="Retrieves the callback function from the specified object copy property list.">H5Pget_mcdt_search_cb</a></td><td>Allows an application to retrieve the callback function from the specified object copy property list.  </td></tr>
<tr>
<td><a class="el" href="_h5_opublic_8h.html#aa35611ba3daa73768194274c0e2a20eb">H5O_mcdt_search_cb_t</a></td><td>Definition of the callback function set by <a class="el" href="group___o_c_p_y_p_l.html#ga9e0448885990a1b9ebd4493b7604f0c1" title="Sets the callback function that H5Ocopy() will invoke before searching the entire destination file fo...">H5Pset_mcdt_search_cb</a>. Provides the mechanism by which a user application may set an action for <a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a> to take after checking all suggested paths for a matching committed datatype but before starting the global search of the destination file.  </td></tr>
</table>
<h2><a class="anchor" id="subsec_copying_committed_datatypes_res"></a>
Resources</h2>
<p>See the following for more information.</p>
<p>See the <a class="el" href="_h5_t__u_g.html#sec_datatype">HDF5 Datatypes</a> chapter in the <a class="el" href="_u_g.html">HDF5 User Guide</a>.</p>
<p>See these entries in the <a class="el" href="_r_m.html">HDF5 Reference Manual</a> </p><ul>
<li><a class="el" href="group___h5_o.html#gaa94449be6f67f499be5ddd3fc44f4225" title="Copies an object in an HDF5 file.">H5Ocopy</a> </li>
<li><a class="el" href="group___o_c_p_y_p_l.html#ga8819261e0b4663827212892e10dfc8a6" title="Sets properties to be used when an object is copied.">H5Pset_copy_object</a> </li>
<li><a class="el" href="group___o_c_p_y_p_l.html#gab89c9debe50afca848151ff046afc82f" title="Adds a path to the list of paths that will be searched in the destination file for a matching committ...">H5Padd_merge_committed_dtype_path</a> </li>
<li><a class="el" href="group___o_c_p_y_p_l.html#ga4b8d6496ac56b167dba16729a8bd7adf" title="Clears the list of paths stored in the object copy property list.">H5Pfree_merge_committed_dtype_paths</a> </li>
<li><a class="el" href="group___o_c_p_y_p_l.html#ga9e0448885990a1b9ebd4493b7604f0c1" title="Sets the callback function that H5Ocopy() will invoke before searching the entire destination file fo...">H5Pset_mcdt_search_cb</a> </li>
<li><a class="el" href="group___o_c_p_y_p_l.html#ga5d7b82394d37bda28769a0435300d396" title="Retrieves the callback function from the specified object copy property list.">H5Pget_mcdt_search_cb</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
